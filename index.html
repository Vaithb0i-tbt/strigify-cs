<!DOCTYPE html>
<html>
<head>
  <title>Code Stego</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <h3>Embed Code</h3>
  <textarea id="codeInput" rows="6" cols="50" placeholder="Enter code to hide..."></textarea><br>
  <input id="keyInput" type="password" placeholder="Key"><br>
  <button onclick="hideCode()">Hide Code</button><br>
  <textarea id="outputText" rows="10" cols="50" placeholder="Generated code with hidden content..."></textarea>

  <h3>Extract Code</h3>
  <textarea id="hiddenText" rows="6" cols="50" placeholder="Paste hidden code here..."></textarea><br>
  <input id="keyInput2" type="password" placeholder="Key"><br>
  <button onclick="extractCode()">Extract Code</button><br>
  <textarea id="outputCode" rows="6" cols="50" placeholder="Decrypted code will appear here..."></textarea>

  <script>
    function hideCode() {
      var code = document.getElementById("codeInput").value;
      var key = document.getElementById("keyInput").value;
      if (!code || !key) {
        alert("Enter both code and key.");
        return;
      }

      var encrypted = CryptoJS.AES.encrypt(code, key).toString();
      var base64 = btoa(encrypted);
      var chunks = base64.match(/.{1,20}/g); // split into 20-char chunks

      var fakeCode = "// Hidden Payload Start\n";
      for (var i = 0; i < chunks.length; i++) {
        fakeCode += "// line " + (i + 1) + "\n";
        fakeCode += "/* " + chunks[i] + " */\n";
      }
      fakeCode += "// Hidden Payload End\nfunction main() {\n  console.log(\"Code executed.\");\n}";

      document.getElementById("outputText").value = fakeCode;
    }

    function extractCode() {
      var text = document.getElementById("hiddenText").value;
      var key = document.getElementById("keyInput2").value;
      if (!text || !key) {
        alert("Enter both input and key.");
        return;
      }

      var matches = text.match(/\/\*\s*([A-Za-z0-9+/=]+)\s*\*\//g);
      if (!matches || matches.length === 0) {
        alert("No hidden data found.");
        return;
      }

      var base64 = matches.map(function(m) {
        return m.replace(/\/\*\s*|\s*\*\//g, '');
      }).join('');

      try {
        var encrypted = atob(base64);
        var decrypted = CryptoJS.AES.decrypt(encrypted, key).toString(CryptoJS.enc.Utf8);
        document.getElementById("outputCode").value = decrypted || "❌ Wrong key or invalid data.";
      } catch (e) {
        alert("Error extracting: " + e.message);
      }
    }
  </script>
</body>
</html>
